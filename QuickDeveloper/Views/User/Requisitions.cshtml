@using QuickDeveloper.Controllers;
@using System.Security.Claims;
@model IEnumerable<QuickDeveloper.Models.Model_Requisition>
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor context
@{
    ViewData["Title"] = "Requisitions | QuickDeveloper";
    var token = context.HttpContext.Request.Cookies["token"];
    var user = AuthenticateController.Instance.claimsPrincipal.FindFirst("id").Value;
    var role = AuthenticateController.Instance.claimsPrincipal.FindFirst(ClaimTypes.Role).Value.ToUpper();
    List<Model_Requisition> requistions = Model_DB.Requisitions(user, role);
    int i = 1;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<link rel="stylesheet" href="~/css/requisitions.css" asp-append-version="true" />

<section class="main-content">
    <h3><span style="color: #ED2218">Minhas </span><span style="color: #303457">Requisições</span></h3>

    <table class="table content-table">
        <thead>
            <tr class="bg-table">
                <th>
                    @Html.DisplayName("#")
                </th>
                <th>
                    @Html.DisplayName("Descrição")
                </th>
                <th>
                    @Html.DisplayName("Desenvolvedor")
                </th>
                <th>
                    @Html.DisplayName("Solicitante")
                </th>
                <th>
                    @Html.DisplayName("Data da Requisição")
                </th>
                <th>
                    @Html.DisplayName("Entrar em Contato")
                </th>
            </tr>
        </thead>
        <tbody>
            @if (requistions.Count > 0)
            {
                foreach (var item in requistions)
                {
                    <tr data-toggle="dropdown" class="dropdown-trigger">
                        <td>
                            @Html.DisplayFor(modelItem => i)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.description)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.developer)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.requester)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.dateRequisition)
                        </td>
                        <td>
                            <a href="mailto:@item.email">@Html.DisplayFor(modelItem => item.email)</a>
                        </td>
                    </tr>
                    i++;
                }
            }
            else
            {
                <tr>
                    @if (role.Equals("REGULAR"))
                    {
                        <td colspan="6" style="text-align: center;">
                            Você ainda não tem nenhuma requisição, comece a usar agora mesmo nosso <a asp-area="" asp-controller="Chat" asp-action="ChatBot">ChatBot</a>!
                        </td>
                    }
                    else
                    {
                        <td colspan="6" class="dev-alert">
                            Você ainda não tem nenhuma requisição, aguarde algum solicitante se identificar com suas competências!
                        </td>
                    }
                </tr>
            }

        </tbody>
    </table>
</section>


@if (TempData["Error"] != null)
{
    <script>
        alert("@TempData["Error"]");
        @{
            TempData["Error"] = null;
        }
    </script>
}

<script src="/js/requisitions.js"></script>
